<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${noticia.titulo} + ' - Niagara Viajes'">Detalle Noticia - Niagara Viajes Parque Bicentenario</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Library para animaciones -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- CSS personalizados -->
    <link th:href="@{/css/main.css}" rel="stylesheet">
    <link th:href="@{/css/header.css}" rel="stylesheet">
    <link th:href="@{/css/noticia-detalle.css}" rel="stylesheet">
    
    <style>
        /* Estilos adicionales para estructura flexbox */
        body.noticia-detalle-page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        main.content-wrapper {
            flex: 1 0 auto;
        }
        
        .detail-section {
            flex: 1;
        }
    </style>
</head>
<body class="noticia-detalle-page">
    <!-- Loading Bar -->
    <div class="loading-bar" id="loadingBar"></div>

    <!-- Header / Navbar Fragment -->
    <div th:replace="~{fragments/header :: header}"></div>

    <!-- Contenido principal -->
    <main class="content-wrapper">
        <section class="detail-section">
            <div class="container">
                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb" class="breadcrumb-custom" data-aos="fade-up">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/}">Inicio</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/noticias}">Noticias</a></li>
                        <li class="breadcrumb-item active" aria-current="page" th:text="${noticia.titulo}">Detalle Noticia</li>
                    </ol>
                </nav>

                <!-- Mensaje si no hay noticia -->
                <div th:if="${noticia == null}" class="alert alert-warning" data-aos="fade-up">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    La noticia solicitada no existe o ha sido eliminada.
                    <a th:href="@{/noticias}" class="alert-link">Volver a noticias</a>
                </div>

                <!-- Contenido principal -->
                <div th:if="${noticia != null}">
                    <!-- Cabecera de la noticia -->
                    <div class="news-detail-header" data-aos="fade-up">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <span class="news-category">Viajes y Turismo</span>
                            <span th:if="${noticia.destacada}" class="featured-badge" data-aos="zoom-in">
                                <i class="fas fa-star me-1"></i>Destacada
                            </span>
                        </div>
                        
                        <h1 class="news-title" th:text="${noticia.titulo}">Título de la noticia</h1>
                        
                        <div class="news-meta">
                            <div class="news-meta-item">
                                <i class="far fa-calendar"></i>
                                <span>Publicada recientemente</span>
                            </div>
                            <div class="news-meta-item">
                                <i class="fas fa-user"></i>
                                <span>Niagara Viajes</span>
                            </div>
                            <div class="news-meta-item">
                                <i class="far fa-clock"></i>
                                <span id="readingTime">Calculando tiempo de lectura...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Imagen principal -->
                    <div class="row" data-aos="fade-up">
                        <div class="col-12">
                            <img th:src="${noticia.imagenUrl ?: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'}" 
                                 alt="Imagen de noticia"
                                 class="news-hero-image">
                        </div>
                    </div>

                    <!-- Contenido y Sidebar -->
                    <div class="row">
                        <!-- Contenido principal -->
                        <div class="col-lg-8" data-aos="fade-up">
                            <div class="news-content" id="newsContent">
                                <!-- Aquí va el contenido dinámico de la noticia -->
                                <div th:if="${noticia.contenido != null}" th:utext="${noticia.contenido}">
                                    <p>Este es el contenido completo de la noticia. Aquí puedes incluir texto extenso, imágenes, videos y cualquier otro contenido relevante.</p>
                                    
                                    <h2>Subtítulo de la noticia</h2>
                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                                    
                                    <blockquote>
                                        "Los viajes son la mejor forma de aprender sobre el mundo y sobre uno mismo."
                                    </blockquote>
                                    
                                    <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                                    
                                    <h3>Lista de puntos importantes</h3>
                                    <ul>
                                        <li>Punto importante número uno</li>
                                        <li>Punto importante número dos</li>
                                        <li>Punto importante número tres</li>
                                    </ul>
                                </div>
                                
                                <div th:if="${noticia.contenido == null}">
                                    <p class="text-muted">No hay contenido disponible para esta noticia.</p>
                                </div>
                                
                                <!-- Tags -->
                                <div class="news-tags">
                                    <span class="tag">Viajes</span>
                                    <span class="tag">Turismo</span>
                                    <span class="tag">Aventura</span>
                                    <span class="tag">Destinos</span>
                                    <span class="tag">Consejos</span>
                                </div>
                            </div>

                            <!-- Compartir en redes sociales -->
                            <div class="mt-5" data-aos="fade-up">
                                <h4 class="sidebar-title mb-3">Compartir esta noticia</h4>
                                <div class="social-share">
                                    <a href="#" class="social-share-btn share-facebook">
                                        <i class="fab fa-facebook-f"></i>
                                    </a>
                                    <a href="#" class="social-share-btn share-twitter">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                    <a href="#" class="social-share-btn share-whatsapp">
                                        <i class="fab fa-whatsapp"></i>
                                    </a>
                                    <a href="#" class="social-share-btn share-linkedin">
                                        <i class="fab fa-linkedin-in"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
                            <!-- Noticias relacionadas -->
                            <div class="sidebar-card">
                                <h4 class="sidebar-title">
                                    <i class="fas fa-newspaper me-2"></i>
                                    Noticias Relacionadas
                                </h4>
                                
                                <div th:if="${noticiasRelacionadas != null and not #lists.isEmpty(noticiasRelacionadas)}">
                                    <div th:each="relacionada : ${noticiasRelacionadas}">
                                        <a th:href="@{/noticias/{id}(id=${relacionada.id})}" class="related-news-item">
                                            <img th:src="${relacionada.imagenUrl ?: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80'}" 
                                                 alt="Noticia relacionada"
                                                 class="related-news-image">
                                            <div>
                                                <h5 class="related-news-title" th:text="${relacionada.titulo}">Título noticia relacionada</h5>
                                                <div class="related-news-date">
                                                    Publicada recientemente
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                
                                <div th:if="${noticiasRelacionadas == null or #lists.isEmpty(noticiasRelacionadas)}">
                                    <p class="text-muted mb-0">No hay noticias relacionadas disponibles.</p>
                                </div>
                            </div>

                            <!-- Información de contacto -->
                            <div class="sidebar-card">
                                <h4 class="sidebar-title">
                                    <i class="fas fa-headset me-2"></i>
                                    ¿Necesitas ayuda?
                                </h4>
                                <p class="mb-2">Nuestros expertos en viajes están listos para ayudarte a planificar tu próxima aventura.</p>
                                <a th:href="@{/#contacto}" class="btn btn-primary w-100 mt-2">
                                    <i class="fas fa-phone me-2"></i>Contáctanos
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Acciones -->
                    <div class="news-actions" data-aos="fade-up">
                        <a th:href="@{/noticias}" class="btn-return">
                            <i class="fas fa-arrow-left me-2"></i>Volver a noticias
                        </a>
                        
                        <div class="d-flex gap-2">
                            <a th:href="@{'/noticias/' + ${noticia.id - 1}}" 
                               class="btn-return" 
                               th:if="${noticia.id > 1}">
                                <i class="fas fa-chevron-left me-2"></i>Anterior
                            </a>
                            <a th:href="@{'/noticias/' + ${noticia.id + 1}}" 
                               class="btn-return">
                                Siguiente<i class="fas fa-chevron-right ms-2"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Noticias relacionadas (sección completa) -->
                    <div th:if="${noticiasRelacionadas != null and not #lists.isEmpty(noticiasRelacionadas)}" 
                         class="related-news-section" 
                         data-aos="fade-up">
                        <h3 class="h4 fw-bold text-primary-blue mb-4">
                            <i class="fas fa-link me-2"></i>
                            Más noticias que te pueden interesar
                        </h3>
                        
                        <div class="row g-4">
                            <div th:each="relacionada : ${noticiasRelacionadas}" class="col-md-4">
                                <div class="related-news-card">
                                    <img th:src="${relacionada.imagenUrl ?: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'}" 
                                         alt="Noticia relacionada"
                                         class="img-fluid">
                                    <div class="card-body p-3">
                                        <div class="mb-2">
                                            <span class="badge bg-primary">Viajes</span>
                                        </div>
                                        <h5 class="h6 mb-2" th:text="${relacionada.titulo}">Título noticia</h5>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                Publicada recientemente
                                            </small>
                                            <a th:href="@{/noticias/{id}(id=${relacionada.id})}" class="btn btn-sm btn-primary">
                                                Leer
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Fragment -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- AOS JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- JavaScript común para el header -->
    <script th:src="@{/javascript/header.js}"></script>
    
    <!-- JavaScript específico para detalle de noticia -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar AOS
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 800,
                    once: true,
                    offset: 100
                });
            }
            
            // Loading bar para enlaces internos
            const loadingBar = document.getElementById('loadingBar');
            const internalLinks = document.querySelectorAll('a[href^="/"]');
            
            internalLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Solo para enlaces internos (no para enlaces a secciones con #)
                    if (!this.getAttribute('href').startsWith('#') && 
                        !this.getAttribute('href').includes('#')) {
                        loadingBar.style.width = '100%';
                        setTimeout(() => {
                            loadingBar.style.width = '0';
                        }, 800);
                    }
                });
            });
            
            // Compartir en redes sociales
            const shareButtons = document.querySelectorAll('.social-share-btn');
            shareButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const currentUrl = encodeURIComponent(window.location.href);
                    const title = encodeURIComponent(document.title);
                    let shareUrl;
                    
                    if (this.classList.contains('share-facebook')) {
                        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${currentUrl}`;
                    } else if (this.classList.contains('share-twitter')) {
                        shareUrl = `https://twitter.com/intent/tweet?url=${currentUrl}&text=${title}`;
                    } else if (this.classList.contains('share-whatsapp')) {
                        shareUrl = `https://wa.me/?text=${title}%20${currentUrl}`;
                    } else if (this.classList.contains('share-linkedin')) {
                        shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${currentUrl}&title=${title}`;
                    }
                    
                    if (shareUrl) {
                        window.open(shareUrl, '_blank', 'width=600,height=400');
                    }
                });
            });
            
            // Smooth scroll para enlaces de anclaje
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                    }
                });
            });
            
            // Calcular tiempo de lectura
            function calculateReadingTime() {
                const contentElement = document.getElementById('newsContent');
                if (contentElement) {
                    const text = contentElement.textContent;
                    const wordCount = text.split(/\s+/).length;
                    const readingTime = Math.ceil(wordCount / 200); // 200 palabras por minuto
                    
                    const readingTimeElement = document.getElementById('readingTime');
                    if (readingTimeElement) {
                        if (readingTime === 0) {
                            readingTimeElement.textContent = 'Lectura rápida';
                        } else {
                            readingTimeElement.textContent = `Lectura de ${readingTime} min`;
                        }
                    }
                }
            }
            
            // Calcular tiempo de lectura después de cargar el contenido
            setTimeout(calculateReadingTime, 500);
            
            // Manejo de tags
            const tags = document.querySelectorAll('.tag');
            tags.forEach(tag => {
                tag.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tagText = this.textContent;
                    // Aquí puedes agregar funcionalidad para filtrar por tag
                    console.log('Filtrar por tag:', tagText);
                });
            });
            
            // Inicializar tooltips si es necesario
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            if (tooltipTriggerList.length > 0) {
                tooltipTriggerList.map(function(tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            }
        });
        
        // Manejar el evento antes de recargar la página
        window.addEventListener('beforeunload', function() {
            const loadingBar = document.getElementById('loadingBar');
            if (loadingBar) {
                loadingBar.style.width = '100%';
            }
        });
    </script>
</body>
</html>